"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/stemmap";
exports.ids = ["pages/api/stemmap"];
exports.modules = {

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "uuid":
/*!***********************!*\
  !*** external "uuid" ***!
  \***********************/
/***/ ((module) => {

module.exports = import("uuid");;

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstemmap&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fstemmap.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstemmap&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fstemmap.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_stemmap_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/pages/api/stemmap.js */ \"(api)/./src/pages/api/stemmap.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_stemmap_js__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_stemmap_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_stemmap_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_stemmap_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/stemmap\",\n        pathname: \"/api/stemmap\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_stemmap_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnN0ZW1tYXAmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZzcmMlMkZwYWdlcyUyRmFwaSUyRnN0ZW1tYXAuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDdUQ7QUFDdkQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHNEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxzREFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90aHJpdmVuLXdlYi8/OTRhZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vc3JjL3BhZ2VzL2FwaS9zdGVtbWFwLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3RlbW1hcFwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3N0ZW1tYXBcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstemmap&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fstemmap.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/lib/cli.js":
/*!************************!*\
  !*** ./src/lib/cli.js ***!
  \************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   analyze: () => (/* binding */ analyze),\n/* harmony export */   applyStemmap: () => (/* binding */ applyStemmap),\n/* harmony export */   exportFiles: () => (/* binding */ exportFiles),\n/* harmony export */   prepBR864: () => (/* binding */ prepBR864),\n/* harmony export */   process: () => (/* binding */ process),\n/* harmony export */   runCommand: () => (/* binding */ runCommand),\n/* harmony export */   scan: () => (/* binding */ scan),\n/* harmony export */   stemmap: () => (/* binding */ stemmap)\n/* harmony export */ });\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var url__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! url */ \"url\");\n\n\n\n// Get the directory of the current module\nconst __filename = (0,url__WEBPACK_IMPORTED_MODULE_2__.fileURLToPath)(\"file:///app/web/src/lib/cli.js\");\nconst __dirname = path__WEBPACK_IMPORTED_MODULE_1__.dirname(__filename);\n// CLI path relative to the web directory\nconst CLI_PATH = path__WEBPACK_IMPORTED_MODULE_1__.join(__dirname, \"..\", \"..\", \"..\", \"bin\", \"thriven\");\n/**\n * Execute a CLI command and return the result\n */ function runCommand(command, args = [], options = {}) {\n    return new Promise((resolve, reject)=>{\n        const nodeArgs = [\n            CLI_PATH,\n            command,\n            ...args\n        ];\n        const proc = (0,child_process__WEBPACK_IMPORTED_MODULE_0__.spawn)(\"node\", nodeArgs, {\n            cwd: options.cwd || \"/app\",\n            env: {\n                ...process.env,\n                ...options.env\n            }\n        });\n        let stdout = \"\";\n        let stderr = \"\";\n        let progress = 0;\n        proc.stdout.on(\"data\", (data)=>{\n            const text = data.toString();\n            stdout += text;\n            // Parse progress from output if available\n            const progressMatch = text.match(/(\\d+)%/);\n            if (progressMatch) {\n                progress = parseInt(progressMatch[1], 10);\n                if (options.onProgress) {\n                    options.onProgress(progress);\n                }\n            }\n        });\n        proc.stderr.on(\"data\", (data)=>{\n            stderr += data.toString();\n        });\n        proc.on(\"error\", (error)=>{\n            reject(new Error(`Failed to start command: ${error.message}`));\n        });\n        proc.on(\"close\", (code)=>{\n            if (code === 0) {\n                resolve({\n                    stdout,\n                    stderr,\n                    code\n                });\n            } else {\n                reject(new Error(`Command exited with code ${code}: ${stderr || stdout}`));\n            }\n        });\n    });\n}\n/**\n * Scan a folder for audio files\n */ async function scan(folder, options = {}) {\n    const args = [\n        folder\n    ];\n    if (options.output) args.push(\"-o\", options.output);\n    if (options.formats) args.push(\"--formats\", options.formats);\n    if (options.recursive !== false) args.push(\"-r\");\n    if (options.verbose) args.push(\"-v\");\n    return runCommand(\"scan\", args, options);\n}\n/**\n * Analyze audio files from raw_index.json\n */ async function analyze(indexPath, options = {}) {\n    const args = [\n        indexPath\n    ];\n    if (options.output) args.push(\"-o\", options.output);\n    if (options.parallel) args.push(\"-p\", String(options.parallel));\n    if (options.noLoudness) args.push(\"--no-loudness\");\n    if (options.noSilence) args.push(\"--no-silence\");\n    if (options.verbose) args.push(\"-v\");\n    return runCommand(\"analyze\", args, options);\n}\n/**\n * Export top N ranked files\n */ async function exportFiles(analysisPath, options = {}) {\n    const args = [\n        analysisPath\n    ];\n    if (options.top) args.push(\"-t\", String(options.top));\n    if (options.output) args.push(\"-o\", options.output);\n    if (options.saveRanked) args.push(\"--save-ranked\", options.saveRanked);\n    if (options.verbose) args.push(\"-v\");\n    return runCommand(\"export\", args, options);\n}\n/**\n * Generate stemmap.yaml template\n */ async function stemmap(packDir, options = {}) {\n    const args = [\n        packDir\n    ];\n    if (options.inDir) args.push(\"--in\", options.inDir);\n    if (options.outPath) args.push(\"--out\", options.outPath);\n    if (options.bpmMin) args.push(\"--bpm-min\", String(options.bpmMin));\n    if (options.bpmMax) args.push(\"--bpm-max\", String(options.bpmMax));\n    if (options.title) args.push(\"--title\", options.title);\n    if (options.verbose) args.push(\"-v\");\n    return runCommand(\"stemmap\", args, options);\n}\n/**\n * Apply stemmap.yaml to create stems_8/\n */ async function applyStemmap(packDir, options = {}) {\n    const args = [\n        packDir\n    ];\n    if (options.map) args.push(\"--map\", options.map);\n    if (options.inDir) args.push(\"--in\", options.inDir);\n    if (options.outDir) args.push(\"--out\", options.outDir);\n    if (options.verbose) args.push(\"-v\");\n    return runCommand(\"apply-stemmap\", args, options);\n}\n/**\n * Prepare stems for BR-864\n */ async function prepBR864(packDir, options = {}) {\n    const args = [\n        packDir\n    ];\n    if (options.inDir) args.push(\"--in\", options.inDir);\n    if (options.outDir) args.push(\"--out\", options.outDir);\n    if (options.padToLongest) args.push(\"--pad-to-longest\");\n    if (options.trimToShortest) args.push(\"--trim-to-shortest\");\n    if (options.verbose) args.push(\"-v\");\n    return runCommand(\"prep-br864\", args, options);\n}\n/**\n * Run the full process pipeline\n */ async function process(folder, options = {}) {\n    const args = [\n        folder\n    ];\n    if (options.top) args.push(\"-t\", String(options.top));\n    if (options.output) args.push(\"-o\", options.output);\n    if (options.verbose) args.push(\"-v\");\n    return runCommand(\"process\", args, options);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixPQUFPLEVBQUUvQixLQUFLNEIsSUFBSSxDQUFDO0lBRS9CLE9BQU85QixXQUFXLGNBQWNFLE1BQU1DO0FBQ3hDO0FBRUE7O0NBRUMsR0FDTSxlQUFlUSxRQUFRaUIsTUFBTSxFQUFFekIsVUFBVSxDQUFDLENBQUM7SUFDaEQsTUFBTUQsT0FBTztRQUFDMEI7S0FBTztJQUNyQixJQUFJekIsUUFBUXVDLEdBQUcsRUFBRXhDLEtBQUs0QixJQUFJLENBQUMsTUFBTU8sT0FBT2xDLFFBQVF1QyxHQUFHO0lBQ25ELElBQUl2QyxRQUFRMEIsTUFBTSxFQUFFM0IsS0FBSzRCLElBQUksQ0FBQyxNQUFNM0IsUUFBUTBCLE1BQU07SUFDbEQsSUFBSTFCLFFBQVE4QixPQUFPLEVBQUUvQixLQUFLNEIsSUFBSSxDQUFDO0lBRS9CLE9BQU85QixXQUFXLFdBQVdFLE1BQU1DO0FBQ3JDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhyaXZlbi13ZWIvLi9zcmMvbGliL2NsaS5qcz9kNDkyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNwYXduIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGZpbGVVUkxUb1BhdGggfSBmcm9tICd1cmwnO1xuXG4vLyBHZXQgdGhlIGRpcmVjdG9yeSBvZiB0aGUgY3VycmVudCBtb2R1bGVcbmNvbnN0IF9fZmlsZW5hbWUgPSBmaWxlVVJMVG9QYXRoKGltcG9ydC5tZXRhLnVybCk7XG5jb25zdCBfX2Rpcm5hbWUgPSBwYXRoLmRpcm5hbWUoX19maWxlbmFtZSk7XG5cbi8vIENMSSBwYXRoIHJlbGF0aXZlIHRvIHRoZSB3ZWIgZGlyZWN0b3J5XG5jb25zdCBDTElfUEFUSCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicsICcuLicsICcuLicsICdiaW4nLCAndGhyaXZlbicpO1xuXG4vKipcbiAqIEV4ZWN1dGUgYSBDTEkgY29tbWFuZCBhbmQgcmV0dXJuIHRoZSByZXN1bHRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJ1bkNvbW1hbmQoY29tbWFuZCwgYXJncyA9IFtdLCBvcHRpb25zID0ge30pIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCBub2RlQXJncyA9IFtDTElfUEFUSCwgY29tbWFuZCwgLi4uYXJnc107XG4gICAgY29uc3QgcHJvYyA9IHNwYXduKCdub2RlJywgbm9kZUFyZ3MsIHtcbiAgICAgIGN3ZDogb3B0aW9ucy5jd2QgfHwgJy9hcHAnLFxuICAgICAgZW52OiB7IC4uLnByb2Nlc3MuZW52LCAuLi5vcHRpb25zLmVudiB9LFxuICAgIH0pO1xuXG4gICAgbGV0IHN0ZG91dCA9ICcnO1xuICAgIGxldCBzdGRlcnIgPSAnJztcbiAgICBsZXQgcHJvZ3Jlc3MgPSAwO1xuXG4gICAgcHJvYy5zdGRvdXQub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xuICAgICAgY29uc3QgdGV4dCA9IGRhdGEudG9TdHJpbmcoKTtcbiAgICAgIHN0ZG91dCArPSB0ZXh0O1xuICAgICAgLy8gUGFyc2UgcHJvZ3Jlc3MgZnJvbSBvdXRwdXQgaWYgYXZhaWxhYmxlXG4gICAgICBjb25zdCBwcm9ncmVzc01hdGNoID0gdGV4dC5tYXRjaCgvKFxcZCspJS8pO1xuICAgICAgaWYgKHByb2dyZXNzTWF0Y2gpIHtcbiAgICAgICAgcHJvZ3Jlc3MgPSBwYXJzZUludChwcm9ncmVzc01hdGNoWzFdLCAxMCk7XG4gICAgICAgIGlmIChvcHRpb25zLm9uUHJvZ3Jlc3MpIHtcbiAgICAgICAgICBvcHRpb25zLm9uUHJvZ3Jlc3MocHJvZ3Jlc3MpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBwcm9jLnN0ZGVyci5vbignZGF0YScsIChkYXRhKSA9PiB7XG4gICAgICBzdGRlcnIgKz0gZGF0YS50b1N0cmluZygpO1xuICAgIH0pO1xuXG4gICAgcHJvYy5vbignZXJyb3InLCAoZXJyb3IpID0+IHtcbiAgICAgIHJlamVjdChuZXcgRXJyb3IoYEZhaWxlZCB0byBzdGFydCBjb21tYW5kOiAke2Vycm9yLm1lc3NhZ2V9YCkpO1xuICAgIH0pO1xuXG4gICAgcHJvYy5vbignY2xvc2UnLCAoY29kZSkgPT4ge1xuICAgICAgaWYgKGNvZGUgPT09IDApIHtcbiAgICAgICAgcmVzb2x2ZSh7IHN0ZG91dCwgc3RkZXJyLCBjb2RlIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihgQ29tbWFuZCBleGl0ZWQgd2l0aCBjb2RlICR7Y29kZX06ICR7c3RkZXJyIHx8IHN0ZG91dH1gKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIFNjYW4gYSBmb2xkZXIgZm9yIGF1ZGlvIGZpbGVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzY2FuKGZvbGRlciwgb3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IGFyZ3MgPSBbZm9sZGVyXTtcbiAgaWYgKG9wdGlvbnMub3V0cHV0KSBhcmdzLnB1c2goJy1vJywgb3B0aW9ucy5vdXRwdXQpO1xuICBpZiAob3B0aW9ucy5mb3JtYXRzKSBhcmdzLnB1c2goJy0tZm9ybWF0cycsIG9wdGlvbnMuZm9ybWF0cyk7XG4gIGlmIChvcHRpb25zLnJlY3Vyc2l2ZSAhPT0gZmFsc2UpIGFyZ3MucHVzaCgnLXInKTtcbiAgaWYgKG9wdGlvbnMudmVyYm9zZSkgYXJncy5wdXNoKCctdicpO1xuICBcbiAgcmV0dXJuIHJ1bkNvbW1hbmQoJ3NjYW4nLCBhcmdzLCBvcHRpb25zKTtcbn1cblxuLyoqXG4gKiBBbmFseXplIGF1ZGlvIGZpbGVzIGZyb20gcmF3X2luZGV4Lmpzb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFuYWx5emUoaW5kZXhQYXRoLCBvcHRpb25zID0ge30pIHtcbiAgY29uc3QgYXJncyA9IFtpbmRleFBhdGhdO1xuICBpZiAob3B0aW9ucy5vdXRwdXQpIGFyZ3MucHVzaCgnLW8nLCBvcHRpb25zLm91dHB1dCk7XG4gIGlmIChvcHRpb25zLnBhcmFsbGVsKSBhcmdzLnB1c2goJy1wJywgU3RyaW5nKG9wdGlvbnMucGFyYWxsZWwpKTtcbiAgaWYgKG9wdGlvbnMubm9Mb3VkbmVzcykgYXJncy5wdXNoKCctLW5vLWxvdWRuZXNzJyk7XG4gIGlmIChvcHRpb25zLm5vU2lsZW5jZSkgYXJncy5wdXNoKCctLW5vLXNpbGVuY2UnKTtcbiAgaWYgKG9wdGlvbnMudmVyYm9zZSkgYXJncy5wdXNoKCctdicpO1xuICBcbiAgcmV0dXJuIHJ1bkNvbW1hbmQoJ2FuYWx5emUnLCBhcmdzLCBvcHRpb25zKTtcbn1cblxuLyoqXG4gKiBFeHBvcnQgdG9wIE4gcmFua2VkIGZpbGVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHBvcnRGaWxlcyhhbmFseXNpc1BhdGgsIG9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBhcmdzID0gW2FuYWx5c2lzUGF0aF07XG4gIGlmIChvcHRpb25zLnRvcCkgYXJncy5wdXNoKCctdCcsIFN0cmluZyhvcHRpb25zLnRvcCkpO1xuICBpZiAob3B0aW9ucy5vdXRwdXQpIGFyZ3MucHVzaCgnLW8nLCBvcHRpb25zLm91dHB1dCk7XG4gIGlmIChvcHRpb25zLnNhdmVSYW5rZWQpIGFyZ3MucHVzaCgnLS1zYXZlLXJhbmtlZCcsIG9wdGlvbnMuc2F2ZVJhbmtlZCk7XG4gIGlmIChvcHRpb25zLnZlcmJvc2UpIGFyZ3MucHVzaCgnLXYnKTtcbiAgXG4gIHJldHVybiBydW5Db21tYW5kKCdleHBvcnQnLCBhcmdzLCBvcHRpb25zKTtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSBzdGVtbWFwLnlhbWwgdGVtcGxhdGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0ZW1tYXAocGFja0Rpciwgb3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IGFyZ3MgPSBbcGFja0Rpcl07XG4gIGlmIChvcHRpb25zLmluRGlyKSBhcmdzLnB1c2goJy0taW4nLCBvcHRpb25zLmluRGlyKTtcbiAgaWYgKG9wdGlvbnMub3V0UGF0aCkgYXJncy5wdXNoKCctLW91dCcsIG9wdGlvbnMub3V0UGF0aCk7XG4gIGlmIChvcHRpb25zLmJwbU1pbikgYXJncy5wdXNoKCctLWJwbS1taW4nLCBTdHJpbmcob3B0aW9ucy5icG1NaW4pKTtcbiAgaWYgKG9wdGlvbnMuYnBtTWF4KSBhcmdzLnB1c2goJy0tYnBtLW1heCcsIFN0cmluZyhvcHRpb25zLmJwbU1heCkpO1xuICBpZiAob3B0aW9ucy50aXRsZSkgYXJncy5wdXNoKCctLXRpdGxlJywgb3B0aW9ucy50aXRsZSk7XG4gIGlmIChvcHRpb25zLnZlcmJvc2UpIGFyZ3MucHVzaCgnLXYnKTtcbiAgXG4gIHJldHVybiBydW5Db21tYW5kKCdzdGVtbWFwJywgYXJncywgb3B0aW9ucyk7XG59XG5cbi8qKlxuICogQXBwbHkgc3RlbW1hcC55YW1sIHRvIGNyZWF0ZSBzdGVtc184L1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXBwbHlTdGVtbWFwKHBhY2tEaXIsIG9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBhcmdzID0gW3BhY2tEaXJdO1xuICBpZiAob3B0aW9ucy5tYXApIGFyZ3MucHVzaCgnLS1tYXAnLCBvcHRpb25zLm1hcCk7XG4gIGlmIChvcHRpb25zLmluRGlyKSBhcmdzLnB1c2goJy0taW4nLCBvcHRpb25zLmluRGlyKTtcbiAgaWYgKG9wdGlvbnMub3V0RGlyKSBhcmdzLnB1c2goJy0tb3V0Jywgb3B0aW9ucy5vdXREaXIpO1xuICBpZiAob3B0aW9ucy52ZXJib3NlKSBhcmdzLnB1c2goJy12Jyk7XG4gIFxuICByZXR1cm4gcnVuQ29tbWFuZCgnYXBwbHktc3RlbW1hcCcsIGFyZ3MsIG9wdGlvbnMpO1xufVxuXG4vKipcbiAqIFByZXBhcmUgc3RlbXMgZm9yIEJSLTg2NFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJlcEJSODY0KHBhY2tEaXIsIG9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBhcmdzID0gW3BhY2tEaXJdO1xuICBpZiAob3B0aW9ucy5pbkRpcikgYXJncy5wdXNoKCctLWluJywgb3B0aW9ucy5pbkRpcik7XG4gIGlmIChvcHRpb25zLm91dERpcikgYXJncy5wdXNoKCctLW91dCcsIG9wdGlvbnMub3V0RGlyKTtcbiAgaWYgKG9wdGlvbnMucGFkVG9Mb25nZXN0KSBhcmdzLnB1c2goJy0tcGFkLXRvLWxvbmdlc3QnKTtcbiAgaWYgKG9wdGlvbnMudHJpbVRvU2hvcnRlc3QpIGFyZ3MucHVzaCgnLS10cmltLXRvLXNob3J0ZXN0Jyk7XG4gIGlmIChvcHRpb25zLnZlcmJvc2UpIGFyZ3MucHVzaCgnLXYnKTtcbiAgXG4gIHJldHVybiBydW5Db21tYW5kKCdwcmVwLWJyODY0JywgYXJncywgb3B0aW9ucyk7XG59XG5cbi8qKlxuICogUnVuIHRoZSBmdWxsIHByb2Nlc3MgcGlwZWxpbmVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3MoZm9sZGVyLCBvcHRpb25zID0ge30pIHtcbiAgY29uc3QgYXJncyA9IFtmb2xkZXJdO1xuICBpZiAob3B0aW9ucy50b3ApIGFyZ3MucHVzaCgnLXQnLCBTdHJpbmcob3B0aW9ucy50b3ApKTtcbiAgaWYgKG9wdGlvbnMub3V0cHV0KSBhcmdzLnB1c2goJy1vJywgb3B0aW9ucy5vdXRwdXQpO1xuICBpZiAob3B0aW9ucy52ZXJib3NlKSBhcmdzLnB1c2goJy12Jyk7XG4gIFxuICByZXR1cm4gcnVuQ29tbWFuZCgncHJvY2VzcycsIGFyZ3MsIG9wdGlvbnMpO1xufVxuIl0sIm5hbWVzIjpbInNwYXduIiwicGF0aCIsImZpbGVVUkxUb1BhdGgiLCJfX2ZpbGVuYW1lIiwidXJsIiwiX19kaXJuYW1lIiwiZGlybmFtZSIsIkNMSV9QQVRIIiwiam9pbiIsInJ1bkNvbW1hbmQiLCJjb21tYW5kIiwiYXJncyIsIm9wdGlvbnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm5vZGVBcmdzIiwicHJvYyIsImN3ZCIsImVudiIsInByb2Nlc3MiLCJzdGRvdXQiLCJzdGRlcnIiLCJwcm9ncmVzcyIsIm9uIiwiZGF0YSIsInRleHQiLCJ0b1N0cmluZyIsInByb2dyZXNzTWF0Y2giLCJtYXRjaCIsInBhcnNlSW50Iiwib25Qcm9ncmVzcyIsImVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwiY29kZSIsInNjYW4iLCJmb2xkZXIiLCJvdXRwdXQiLCJwdXNoIiwiZm9ybWF0cyIsInJlY3Vyc2l2ZSIsInZlcmJvc2UiLCJhbmFseXplIiwiaW5kZXhQYXRoIiwicGFyYWxsZWwiLCJTdHJpbmciLCJub0xvdWRuZXNzIiwibm9TaWxlbmNlIiwiZXhwb3J0RmlsZXMiLCJhbmFseXNpc1BhdGgiLCJ0b3AiLCJzYXZlUmFua2VkIiwic3RlbW1hcCIsInBhY2tEaXIiLCJpbkRpciIsIm91dFBhdGgiLCJicG1NaW4iLCJicG1NYXgiLCJ0aXRsZSIsImFwcGx5U3RlbW1hcCIsIm1hcCIsIm91dERpciIsInByZXBCUjg2NCIsInBhZFRvTG9uZ2VzdCIsInRyaW1Ub1Nob3J0ZXN0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/cli.js\n");

/***/ }),

/***/ "(api)/./src/lib/db.js":
/*!***********************!*\
  !*** ./src/lib/db.js ***!
  \***********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createUpload: () => (/* binding */ createUpload),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getAllUploads: () => (/* binding */ getAllUploads),\n/* harmony export */   getAnalysisResult: () => (/* binding */ getAnalysisResult),\n/* harmony export */   getExports: () => (/* binding */ getExports),\n/* harmony export */   getStemmap: () => (/* binding */ getStemmap),\n/* harmony export */   getUpload: () => (/* binding */ getUpload),\n/* harmony export */   saveAnalysisResult: () => (/* binding */ saveAnalysisResult),\n/* harmony export */   saveExport: () => (/* binding */ saveExport),\n/* harmony export */   saveStemmap: () => (/* binding */ saveStemmap),\n/* harmony export */   updateUploadStatus: () => (/* binding */ updateUploadStatus)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n\nconst MONGO_URL = process.env.MONGO_URL || \"mongodb://localhost:27017\";\nconst DB_NAME = process.env.DB_NAME || \"thriven\";\nlet client = null;\nlet db = null;\nasync function getDb() {\n    if (db) return db;\n    client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(MONGO_URL);\n    await client.connect();\n    db = client.db(DB_NAME);\n    // Create indexes for better performance\n    await db.collection(\"uploads\").createIndex({\n        created_at: -1\n    });\n    await db.collection(\"analysis_results\").createIndex({\n        upload_id: 1\n    });\n    await db.collection(\"stemmaps\").createIndex({\n        upload_id: 1\n    });\n    await db.collection(\"exports\").createIndex({\n        upload_id: 1,\n        created_at: -1\n    });\n    return db;\n}\nasync function createUpload(data) {\n    const database = await getDb();\n    const collection = database.collection(\"uploads\");\n    const doc = {\n        _id: data.id,\n        folder_path: data.folder_path,\n        folder_name: data.folder_name,\n        file_count: data.file_count || 0,\n        total_size_bytes: data.total_size_bytes || 0,\n        status: data.status || \"pending\",\n        created_at: new Date()\n    };\n    await collection.insertOne(doc);\n    return {\n        ...doc,\n        id: doc._id\n    };\n}\nasync function getUpload(id) {\n    const database = await getDb();\n    const collection = database.collection(\"uploads\");\n    const doc = await collection.findOne({\n        _id: id\n    });\n    if (doc) {\n        return {\n            ...doc,\n            id: doc._id\n        };\n    }\n    return null;\n}\nasync function getAllUploads() {\n    const database = await getDb();\n    const collection = database.collection(\"uploads\");\n    const docs = await collection.find({}).sort({\n        created_at: -1\n    }).toArray();\n    return docs.map((doc)=>({\n            ...doc,\n            id: doc._id\n        }));\n}\nasync function updateUploadStatus(id, status) {\n    const database = await getDb();\n    const collection = database.collection(\"uploads\");\n    await collection.updateOne({\n        _id: id\n    }, {\n        $set: {\n            status\n        }\n    });\n}\nasync function saveAnalysisResult(data) {\n    const database = await getDb();\n    const collection = database.collection(\"analysis_results\");\n    const doc = {\n        _id: data.id,\n        upload_id: data.upload_id,\n        raw_index_json: data.raw_index_json,\n        analysis_index_json: data.analysis_index_json,\n        duplicates_json: data.duplicates_json,\n        created_at: new Date()\n    };\n    await collection.replaceOne({\n        upload_id: data.upload_id\n    }, doc, {\n        upsert: true\n    });\n    return {\n        ...doc,\n        id: doc._id\n    };\n}\nasync function getAnalysisResult(uploadId) {\n    const database = await getDb();\n    const collection = database.collection(\"analysis_results\");\n    const doc = await collection.findOne({\n        upload_id: uploadId\n    });\n    if (doc) {\n        return {\n            ...doc,\n            id: doc._id\n        };\n    }\n    return null;\n}\nasync function saveStemmap(data) {\n    const database = await getDb();\n    const collection = database.collection(\"stemmaps\");\n    const doc = {\n        _id: data.id,\n        upload_id: data.upload_id,\n        stemmap_yaml: data.stemmap_yaml,\n        pack_title: data.pack_title,\n        bpm: data.bpm,\n        key_signature: data.key_signature,\n        created_at: new Date()\n    };\n    await collection.replaceOne({\n        upload_id: data.upload_id\n    }, doc, {\n        upsert: true\n    });\n    return {\n        ...doc,\n        id: doc._id\n    };\n}\nasync function getStemmap(uploadId) {\n    const database = await getDb();\n    const collection = database.collection(\"stemmaps\");\n    const doc = await collection.findOne({\n        upload_id: uploadId\n    });\n    if (doc) {\n        return {\n            ...doc,\n            id: doc._id\n        };\n    }\n    return null;\n}\nasync function saveExport(data) {\n    const database = await getDb();\n    const collection = database.collection(\"exports\");\n    const doc = {\n        _id: data.id,\n        upload_id: data.upload_id,\n        export_type: data.export_type,\n        output_path: data.output_path,\n        manifest_json: data.manifest_json,\n        created_at: new Date()\n    };\n    await collection.insertOne(doc);\n    return {\n        ...doc,\n        id: doc._id\n    };\n}\nasync function getExports(uploadId) {\n    const database = await getDb();\n    const collection = database.collection(\"exports\");\n    const docs = await collection.find({\n        upload_id: uploadId\n    }).sort({\n        created_at: -1\n    }).toArray();\n    return docs.map((doc)=>({\n            ...doc,\n            id: doc._id\n        }));\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({\n    getDb\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cyI6WyJ3ZWJwYWNrOi8vdGhyaXZlbi13ZWIvLi9zcmMvbGliL2RiLmpzPzdmOWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9uZ29DbGllbnQgfSBmcm9tICdtb25nb2RiJztcblxuY29uc3QgTU9OR09fVVJMID0gcHJvY2Vzcy5lbnYuTU9OR09fVVJMIHx8ICdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3JztcbmNvbnN0IERCX05BTUUgPSBwcm9jZXNzLmVudi5EQl9OQU1FIHx8ICd0aHJpdmVuJztcblxubGV0IGNsaWVudCA9IG51bGw7XG5sZXQgZGIgPSBudWxsO1xuXG5hc3luYyBmdW5jdGlvbiBnZXREYigpIHtcbiAgaWYgKGRiKSByZXR1cm4gZGI7XG4gIFxuICBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQoTU9OR09fVVJMKTtcbiAgYXdhaXQgY2xpZW50LmNvbm5lY3QoKTtcbiAgZGIgPSBjbGllbnQuZGIoREJfTkFNRSk7XG4gIFxuICAvLyBDcmVhdGUgaW5kZXhlcyBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG4gIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3VwbG9hZHMnKS5jcmVhdGVJbmRleCh7IGNyZWF0ZWRfYXQ6IC0xIH0pO1xuICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdhbmFseXNpc19yZXN1bHRzJykuY3JlYXRlSW5kZXgoeyB1cGxvYWRfaWQ6IDEgfSk7XG4gIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3N0ZW1tYXBzJykuY3JlYXRlSW5kZXgoeyB1cGxvYWRfaWQ6IDEgfSk7XG4gIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2V4cG9ydHMnKS5jcmVhdGVJbmRleCh7IHVwbG9hZF9pZDogMSwgY3JlYXRlZF9hdDogLTEgfSk7XG4gIFxuICByZXR1cm4gZGI7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVVcGxvYWQoZGF0YSkge1xuICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGdldERiKCk7XG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBkYXRhYmFzZS5jb2xsZWN0aW9uKCd1cGxvYWRzJyk7XG4gIFxuICBjb25zdCBkb2MgPSB7XG4gICAgX2lkOiBkYXRhLmlkLFxuICAgIGZvbGRlcl9wYXRoOiBkYXRhLmZvbGRlcl9wYXRoLFxuICAgIGZvbGRlcl9uYW1lOiBkYXRhLmZvbGRlcl9uYW1lLFxuICAgIGZpbGVfY291bnQ6IGRhdGEuZmlsZV9jb3VudCB8fCAwLFxuICAgIHRvdGFsX3NpemVfYnl0ZXM6IGRhdGEudG90YWxfc2l6ZV9ieXRlcyB8fCAwLFxuICAgIHN0YXR1czogZGF0YS5zdGF0dXMgfHwgJ3BlbmRpbmcnLFxuICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gIH07XG4gIFxuICBhd2FpdCBjb2xsZWN0aW9uLmluc2VydE9uZShkb2MpO1xuICByZXR1cm4geyAuLi5kb2MsIGlkOiBkb2MuX2lkIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVcGxvYWQoaWQpIHtcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBnZXREYigpO1xuICBjb25zdCBjb2xsZWN0aW9uID0gZGF0YWJhc2UuY29sbGVjdGlvbigndXBsb2FkcycpO1xuICBjb25zdCBkb2MgPSBhd2FpdCBjb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGlkIH0pO1xuICBpZiAoZG9jKSB7XG4gICAgcmV0dXJuIHsgLi4uZG9jLCBpZDogZG9jLl9pZCB9O1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsVXBsb2FkcygpIHtcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBnZXREYigpO1xuICBjb25zdCBjb2xsZWN0aW9uID0gZGF0YWJhc2UuY29sbGVjdGlvbigndXBsb2FkcycpO1xuICBjb25zdCBkb2NzID0gYXdhaXQgY29sbGVjdGlvbi5maW5kKHt9KS5zb3J0KHsgY3JlYXRlZF9hdDogLTEgfSkudG9BcnJheSgpO1xuICByZXR1cm4gZG9jcy5tYXAoZG9jID0+ICh7IC4uLmRvYywgaWQ6IGRvYy5faWQgfSkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlVXBsb2FkU3RhdHVzKGlkLCBzdGF0dXMpIHtcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBnZXREYigpO1xuICBjb25zdCBjb2xsZWN0aW9uID0gZGF0YWJhc2UuY29sbGVjdGlvbigndXBsb2FkcycpO1xuICBhd2FpdCBjb2xsZWN0aW9uLnVwZGF0ZU9uZSh7IF9pZDogaWQgfSwgeyAkc2V0OiB7IHN0YXR1cyB9IH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2F2ZUFuYWx5c2lzUmVzdWx0KGRhdGEpIHtcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBnZXREYigpO1xuICBjb25zdCBjb2xsZWN0aW9uID0gZGF0YWJhc2UuY29sbGVjdGlvbignYW5hbHlzaXNfcmVzdWx0cycpO1xuICBcbiAgY29uc3QgZG9jID0ge1xuICAgIF9pZDogZGF0YS5pZCxcbiAgICB1cGxvYWRfaWQ6IGRhdGEudXBsb2FkX2lkLFxuICAgIHJhd19pbmRleF9qc29uOiBkYXRhLnJhd19pbmRleF9qc29uLFxuICAgIGFuYWx5c2lzX2luZGV4X2pzb246IGRhdGEuYW5hbHlzaXNfaW5kZXhfanNvbixcbiAgICBkdXBsaWNhdGVzX2pzb246IGRhdGEuZHVwbGljYXRlc19qc29uLFxuICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gIH07XG4gIFxuICBhd2FpdCBjb2xsZWN0aW9uLnJlcGxhY2VPbmUoXG4gICAgeyB1cGxvYWRfaWQ6IGRhdGEudXBsb2FkX2lkIH0sXG4gICAgZG9jLFxuICAgIHsgdXBzZXJ0OiB0cnVlIH1cbiAgKTtcbiAgcmV0dXJuIHsgLi4uZG9jLCBpZDogZG9jLl9pZCB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QW5hbHlzaXNSZXN1bHQodXBsb2FkSWQpIHtcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBnZXREYigpO1xuICBjb25zdCBjb2xsZWN0aW9uID0gZGF0YWJhc2UuY29sbGVjdGlvbignYW5hbHlzaXNfcmVzdWx0cycpO1xuICBjb25zdCBkb2MgPSBhd2FpdCBjb2xsZWN0aW9uLmZpbmRPbmUoeyB1cGxvYWRfaWQ6IHVwbG9hZElkIH0pO1xuICBpZiAoZG9jKSB7XG4gICAgcmV0dXJuIHsgLi4uZG9jLCBpZDogZG9jLl9pZCB9O1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2F2ZVN0ZW1tYXAoZGF0YSkge1xuICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGdldERiKCk7XG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBkYXRhYmFzZS5jb2xsZWN0aW9uKCdzdGVtbWFwcycpO1xuICBcbiAgY29uc3QgZG9jID0ge1xuICAgIF9pZDogZGF0YS5pZCxcbiAgICB1cGxvYWRfaWQ6IGRhdGEudXBsb2FkX2lkLFxuICAgIHN0ZW1tYXBfeWFtbDogZGF0YS5zdGVtbWFwX3lhbWwsXG4gICAgcGFja190aXRsZTogZGF0YS5wYWNrX3RpdGxlLFxuICAgIGJwbTogZGF0YS5icG0sXG4gICAga2V5X3NpZ25hdHVyZTogZGF0YS5rZXlfc2lnbmF0dXJlLFxuICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gIH07XG4gIFxuICBhd2FpdCBjb2xsZWN0aW9uLnJlcGxhY2VPbmUoXG4gICAgeyB1cGxvYWRfaWQ6IGRhdGEudXBsb2FkX2lkIH0sXG4gICAgZG9jLFxuICAgIHsgdXBzZXJ0OiB0cnVlIH1cbiAgKTtcbiAgcmV0dXJuIHsgLi4uZG9jLCBpZDogZG9jLl9pZCB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U3RlbW1hcCh1cGxvYWRJZCkge1xuICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGdldERiKCk7XG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBkYXRhYmFzZS5jb2xsZWN0aW9uKCdzdGVtbWFwcycpO1xuICBjb25zdCBkb2MgPSBhd2FpdCBjb2xsZWN0aW9uLmZpbmRPbmUoeyB1cGxvYWRfaWQ6IHVwbG9hZElkIH0pO1xuICBpZiAoZG9jKSB7XG4gICAgcmV0dXJuIHsgLi4uZG9jLCBpZDogZG9jLl9pZCB9O1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2F2ZUV4cG9ydChkYXRhKSB7XG4gIGNvbnN0IGRhdGFiYXNlID0gYXdhaXQgZ2V0RGIoKTtcbiAgY29uc3QgY29sbGVjdGlvbiA9IGRhdGFiYXNlLmNvbGxlY3Rpb24oJ2V4cG9ydHMnKTtcbiAgXG4gIGNvbnN0IGRvYyA9IHtcbiAgICBfaWQ6IGRhdGEuaWQsXG4gICAgdXBsb2FkX2lkOiBkYXRhLnVwbG9hZF9pZCxcbiAgICBleHBvcnRfdHlwZTogZGF0YS5leHBvcnRfdHlwZSxcbiAgICBvdXRwdXRfcGF0aDogZGF0YS5vdXRwdXRfcGF0aCxcbiAgICBtYW5pZmVzdF9qc29uOiBkYXRhLm1hbmlmZXN0X2pzb24sXG4gICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgfTtcbiAgXG4gIGF3YWl0IGNvbGxlY3Rpb24uaW5zZXJ0T25lKGRvYyk7XG4gIHJldHVybiB7IC4uLmRvYywgaWQ6IGRvYy5faWQgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEV4cG9ydHModXBsb2FkSWQpIHtcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBnZXREYigpO1xuICBjb25zdCBjb2xsZWN0aW9uID0gZGF0YWJhc2UuY29sbGVjdGlvbignZXhwb3J0cycpO1xuICBjb25zdCBkb2NzID0gYXdhaXQgY29sbGVjdGlvblxuICAgIC5maW5kKHsgdXBsb2FkX2lkOiB1cGxvYWRJZCB9KVxuICAgIC5zb3J0KHsgY3JlYXRlZF9hdDogLTEgfSlcbiAgICAudG9BcnJheSgpO1xuICByZXR1cm4gZG9jcy5tYXAoZG9jID0+ICh7IC4uLmRvYywgaWQ6IGRvYy5faWQgfSkpO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7IGdldERiIH07XG4iXSwibmFtZXMiOlsiTW9uZ29DbGllbnQiLCJNT05HT19VUkwiLCJwcm9jZXNzIiwiZW52IiwiREJfTkFNRSIsImNsaWVudCIsImRiIiwiZ2V0RGIiLCJjb25uZWN0IiwiY29sbGVjdGlvbiIsImNyZWF0ZUluZGV4IiwiY3JlYXRlZF9hdCIsInVwbG9hZF9pZCIsImNyZWF0ZVVwbG9hZCIsImRhdGEiLCJkYXRhYmFzZSIsImRvYyIsIl9pZCIsImlkIiwiZm9sZGVyX3BhdGgiLCJmb2xkZXJfbmFtZSIsImZpbGVfY291bnQiLCJ0b3RhbF9zaXplX2J5dGVzIiwic3RhdHVzIiwiRGF0ZSIsImluc2VydE9uZSIsImdldFVwbG9hZCIsImZpbmRPbmUiLCJnZXRBbGxVcGxvYWRzIiwiZG9jcyIsImZpbmQiLCJzb3J0IiwidG9BcnJheSIsIm1hcCIsInVwZGF0ZVVwbG9hZFN0YXR1cyIsInVwZGF0ZU9uZSIsIiRzZXQiLCJzYXZlQW5hbHlzaXNSZXN1bHQiLCJyYXdfaW5kZXhfanNvbiIsImFuYWx5c2lzX2luZGV4X2pzb24iLCJkdXBsaWNhdGVzX2pzb24iLCJyZXBsYWNlT25lIiwidXBzZXJ0IiwiZ2V0QW5hbHlzaXNSZXN1bHQiLCJ1cGxvYWRJZCIsInNhdmVTdGVtbWFwIiwic3RlbW1hcF95YW1sIiwicGFja190aXRsZSIsImJwbSIsImtleV9zaWduYXR1cmUiLCJnZXRTdGVtbWFwIiwic2F2ZUV4cG9ydCIsImV4cG9ydF90eXBlIiwib3V0cHV0X3BhdGgiLCJtYW5pZmVzdF9qc29uIiwiZ2V0RXhwb3J0cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/db.js\n");

/***/ }),

/***/ "(api)/./src/pages/api/stemmap.js":
/*!**********************************!*\
  !*** ./src/pages/api/stemmap.js ***!
  \**********************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! uuid */ \"uuid\");\n/* harmony import */ var _lib_cli__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/cli */ \"(api)/./src/lib/cli.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/db */ \"(api)/./src/lib/db.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([uuid__WEBPACK_IMPORTED_MODULE_2__]);\nuuid__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nasync function handler(req, res) {\n    if (req.method === \"GET\") {\n        // Get stemmap for upload\n        const { uploadId } = req.query;\n        if (!uploadId) {\n            return res.status(400).json({\n                error: \"uploadId is required\"\n            });\n        }\n        const upload = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.getUpload)(uploadId);\n        if (!upload) {\n            return res.status(404).json({\n                error: \"Upload not found\"\n            });\n        }\n        // Try to read stemmap.yaml from disk\n        const stemmapPath = path__WEBPACK_IMPORTED_MODULE_0__.join(upload.folder_path, \"stemmap.yaml\");\n        try {\n            const yaml = await fs_promises__WEBPACK_IMPORTED_MODULE_1__.readFile(stemmapPath, \"utf-8\");\n            return res.status(200).json({\n                success: true,\n                yaml\n            });\n        } catch  {\n            return res.status(404).json({\n                error: \"Stemmap not found. Generate one first.\"\n            });\n        }\n    }\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    try {\n        const { uploadId, action, stemmapData, padToLongest } = req.body;\n        if (!uploadId) {\n            return res.status(400).json({\n                error: \"uploadId is required\"\n            });\n        }\n        const upload = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.getUpload)(uploadId);\n        if (!upload) {\n            return res.status(404).json({\n                error: \"Upload not found\"\n            });\n        }\n        const packDir = upload.folder_path;\n        if (action === \"generate\") {\n            // Generate stemmap.yaml template\n            const title = req.body.title || \"PACK\";\n            const bpmMin = req.body.bpmMin || 90;\n            const bpmMax = req.body.bpmMax || 190;\n            await (0,_lib_cli__WEBPACK_IMPORTED_MODULE_3__.stemmap)(packDir, {\n                title,\n                bpmMin,\n                bpmMax,\n                verbose: true\n            });\n            // Read the generated stemmap\n            const stemmapPath = path__WEBPACK_IMPORTED_MODULE_0__.join(packDir, \"stemmap.yaml\");\n            const yaml = await fs_promises__WEBPACK_IMPORTED_MODULE_1__.readFile(stemmapPath, \"utf-8\");\n            // Save to database\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.saveStemmap)({\n                id: (0,uuid__WEBPACK_IMPORTED_MODULE_2__.v4)(),\n                upload_id: uploadId,\n                stemmap_yaml: yaml,\n                pack_title: title,\n                bpm: null,\n                key_signature: null\n            });\n            return res.status(200).json({\n                success: true,\n                action: \"generate\",\n                yaml\n            });\n        }\n        if (action === \"save\") {\n            // Save updated stemmap.yaml\n            if (!stemmapData) {\n                return res.status(400).json({\n                    error: \"stemmapData is required\"\n                });\n            }\n            const stemmapPath = path__WEBPACK_IMPORTED_MODULE_0__.join(packDir, \"stemmap.yaml\");\n            await fs_promises__WEBPACK_IMPORTED_MODULE_1__.writeFile(stemmapPath, stemmapData, \"utf-8\");\n            // Update database\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.saveStemmap)({\n                id: (0,uuid__WEBPACK_IMPORTED_MODULE_2__.v4)(),\n                upload_id: uploadId,\n                stemmap_yaml: stemmapData,\n                pack_title: req.body.packTitle || \"PACK\",\n                bpm: req.body.bpm || null,\n                key_signature: req.body.key || null\n            });\n            return res.status(200).json({\n                success: true,\n                action: \"save\"\n            });\n        }\n        if (action === \"apply\") {\n            // Apply stemmap to create stems_8/\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.updateUploadStatus)(uploadId, \"applying-stemmap\");\n            await (0,_lib_cli__WEBPACK_IMPORTED_MODULE_3__.applyStemmap)(packDir, {\n                verbose: true\n            });\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.updateUploadStatus)(uploadId, \"stemmap-applied\");\n            return res.status(200).json({\n                success: true,\n                action: \"apply\",\n                outputDir: \"stems_8\"\n            });\n        }\n        if (action === \"prep-br864\") {\n            // Prepare for BR-864\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.updateUploadStatus)(uploadId, \"preparing-br864\");\n            await (0,_lib_cli__WEBPACK_IMPORTED_MODULE_3__.prepBR864)(packDir, {\n                padToLongest: padToLongest === true,\n                verbose: true\n            });\n            // Read manifest if exists\n            const manifestPath = path__WEBPACK_IMPORTED_MODULE_0__.join(packDir, \"br864_ready\", \"manifest.md\");\n            let manifest = \"\";\n            try {\n                manifest = await fs_promises__WEBPACK_IMPORTED_MODULE_1__.readFile(manifestPath, \"utf-8\");\n            } catch  {}\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.updateUploadStatus)(uploadId, \"br864-ready\");\n            return res.status(200).json({\n                success: true,\n                action: \"prep-br864\",\n                outputDir: \"br864_ready\",\n                manifest\n            });\n        }\n        return res.status(400).json({\n            error: \"Invalid action\"\n        });\n    } catch (error) {\n        console.error(\"Stemmap error:\", error);\n        return res.status(500).json({\n            error: error.message\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUUsT0FBTSxDQUFDO1lBRVQsTUFBTXRDLDJEQUFrQkEsQ0FBQ08sVUFBVTtZQUVuQyxPQUFPRixJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQlEsU0FBUztnQkFDVEMsUUFBUTtnQkFDUmtCLFdBQVc7Z0JBQ1hFO1lBQ0Y7UUFDRjtRQUVBLE9BQU9sQyxJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBaUI7SUFDeEQsRUFBRSxPQUFPQSxPQUFPO1FBQ2Q2QixRQUFRN0IsS0FBSyxDQUFDLGtCQUFrQkE7UUFDaEMsT0FBT04sSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPQSxNQUFNOEIsT0FBTztRQUFDO0lBQ3JEO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90aHJpdmVuLXdlYi8uL3NyYy9wYWdlcy9hcGkvc3RlbW1hcC5qcz84ZGJiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzL3Byb21pc2VzJztcbmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gJ3V1aWQnO1xuaW1wb3J0IHsgc3RlbW1hcCwgYXBwbHlTdGVtbWFwLCBwcmVwQlI4NjQgfSBmcm9tICdAL2xpYi9jbGknO1xuaW1wb3J0IHsgZ2V0VXBsb2FkLCB1cGRhdGVVcGxvYWRTdGF0dXMsIHNhdmVTdGVtbWFwLCBnZXRTdGVtbWFwIH0gZnJvbSAnQC9saWIvZGInO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGlmIChyZXEubWV0aG9kID09PSAnR0VUJykge1xuICAgIC8vIEdldCBzdGVtbWFwIGZvciB1cGxvYWRcbiAgICBjb25zdCB7IHVwbG9hZElkIH0gPSByZXEucXVlcnk7XG4gICAgXG4gICAgaWYgKCF1cGxvYWRJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICd1cGxvYWRJZCBpcyByZXF1aXJlZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgdXBsb2FkID0gYXdhaXQgZ2V0VXBsb2FkKHVwbG9hZElkKTtcbiAgICBpZiAoIXVwbG9hZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdVcGxvYWQgbm90IGZvdW5kJyB9KTtcbiAgICB9XG5cbiAgICAvLyBUcnkgdG8gcmVhZCBzdGVtbWFwLnlhbWwgZnJvbSBkaXNrXG4gICAgY29uc3Qgc3RlbW1hcFBhdGggPSBwYXRoLmpvaW4odXBsb2FkLmZvbGRlcl9wYXRoLCAnc3RlbW1hcC55YW1sJyk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHlhbWwgPSBhd2FpdCBmcy5yZWFkRmlsZShzdGVtbWFwUGF0aCwgJ3V0Zi04Jyk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBzdWNjZXNzOiB0cnVlLCB5YW1sIH0pO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdTdGVtbWFwIG5vdCBmb3VuZC4gR2VuZXJhdGUgb25lIGZpcnN0LicgfSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgeyB1cGxvYWRJZCwgYWN0aW9uLCBzdGVtbWFwRGF0YSwgcGFkVG9Mb25nZXN0IH0gPSByZXEuYm9keTtcblxuICAgIGlmICghdXBsb2FkSWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAndXBsb2FkSWQgaXMgcmVxdWlyZWQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHVwbG9hZCA9IGF3YWl0IGdldFVwbG9hZCh1cGxvYWRJZCk7XG4gICAgaWYgKCF1cGxvYWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnVXBsb2FkIG5vdCBmb3VuZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFja0RpciA9IHVwbG9hZC5mb2xkZXJfcGF0aDtcblxuICAgIGlmIChhY3Rpb24gPT09ICdnZW5lcmF0ZScpIHtcbiAgICAgIC8vIEdlbmVyYXRlIHN0ZW1tYXAueWFtbCB0ZW1wbGF0ZVxuICAgICAgY29uc3QgdGl0bGUgPSByZXEuYm9keS50aXRsZSB8fCAnUEFDSyc7XG4gICAgICBjb25zdCBicG1NaW4gPSByZXEuYm9keS5icG1NaW4gfHwgOTA7XG4gICAgICBjb25zdCBicG1NYXggPSByZXEuYm9keS5icG1NYXggfHwgMTkwO1xuXG4gICAgICBhd2FpdCBzdGVtbWFwKHBhY2tEaXIsIHtcbiAgICAgICAgdGl0bGUsXG4gICAgICAgIGJwbU1pbixcbiAgICAgICAgYnBtTWF4LFxuICAgICAgICB2ZXJib3NlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFJlYWQgdGhlIGdlbmVyYXRlZCBzdGVtbWFwXG4gICAgICBjb25zdCBzdGVtbWFwUGF0aCA9IHBhdGguam9pbihwYWNrRGlyLCAnc3RlbW1hcC55YW1sJyk7XG4gICAgICBjb25zdCB5YW1sID0gYXdhaXQgZnMucmVhZEZpbGUoc3RlbW1hcFBhdGgsICd1dGYtOCcpO1xuXG4gICAgICAvLyBTYXZlIHRvIGRhdGFiYXNlXG4gICAgICBhd2FpdCBzYXZlU3RlbW1hcCh7XG4gICAgICAgIGlkOiB1dWlkdjQoKSxcbiAgICAgICAgdXBsb2FkX2lkOiB1cGxvYWRJZCxcbiAgICAgICAgc3RlbW1hcF95YW1sOiB5YW1sLFxuICAgICAgICBwYWNrX3RpdGxlOiB0aXRsZSxcbiAgICAgICAgYnBtOiBudWxsLFxuICAgICAgICBrZXlfc2lnbmF0dXJlOiBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGFjdGlvbjogJ2dlbmVyYXRlJyxcbiAgICAgICAgeWFtbCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChhY3Rpb24gPT09ICdzYXZlJykge1xuICAgICAgLy8gU2F2ZSB1cGRhdGVkIHN0ZW1tYXAueWFtbFxuICAgICAgaWYgKCFzdGVtbWFwRGF0YSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ3N0ZW1tYXBEYXRhIGlzIHJlcXVpcmVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3RlbW1hcFBhdGggPSBwYXRoLmpvaW4ocGFja0RpciwgJ3N0ZW1tYXAueWFtbCcpO1xuICAgICAgYXdhaXQgZnMud3JpdGVGaWxlKHN0ZW1tYXBQYXRoLCBzdGVtbWFwRGF0YSwgJ3V0Zi04Jyk7XG5cbiAgICAgIC8vIFVwZGF0ZSBkYXRhYmFzZVxuICAgICAgYXdhaXQgc2F2ZVN0ZW1tYXAoe1xuICAgICAgICBpZDogdXVpZHY0KCksXG4gICAgICAgIHVwbG9hZF9pZDogdXBsb2FkSWQsXG4gICAgICAgIHN0ZW1tYXBfeWFtbDogc3RlbW1hcERhdGEsXG4gICAgICAgIHBhY2tfdGl0bGU6IHJlcS5ib2R5LnBhY2tUaXRsZSB8fCAnUEFDSycsXG4gICAgICAgIGJwbTogcmVxLmJvZHkuYnBtIHx8IG51bGwsXG4gICAgICAgIGtleV9zaWduYXR1cmU6IHJlcS5ib2R5LmtleSB8fCBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGFjdGlvbjogJ3NhdmUnLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGFjdGlvbiA9PT0gJ2FwcGx5Jykge1xuICAgICAgLy8gQXBwbHkgc3RlbW1hcCB0byBjcmVhdGUgc3RlbXNfOC9cbiAgICAgIGF3YWl0IHVwZGF0ZVVwbG9hZFN0YXR1cyh1cGxvYWRJZCwgJ2FwcGx5aW5nLXN0ZW1tYXAnKTtcblxuICAgICAgYXdhaXQgYXBwbHlTdGVtbWFwKHBhY2tEaXIsIHtcbiAgICAgICAgdmVyYm9zZTogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCB1cGRhdGVVcGxvYWRTdGF0dXModXBsb2FkSWQsICdzdGVtbWFwLWFwcGxpZWQnKTtcblxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgYWN0aW9uOiAnYXBwbHknLFxuICAgICAgICBvdXRwdXREaXI6ICdzdGVtc184JyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChhY3Rpb24gPT09ICdwcmVwLWJyODY0Jykge1xuICAgICAgLy8gUHJlcGFyZSBmb3IgQlItODY0XG4gICAgICBhd2FpdCB1cGRhdGVVcGxvYWRTdGF0dXModXBsb2FkSWQsICdwcmVwYXJpbmctYnI4NjQnKTtcblxuICAgICAgYXdhaXQgcHJlcEJSODY0KHBhY2tEaXIsIHtcbiAgICAgICAgcGFkVG9Mb25nZXN0OiBwYWRUb0xvbmdlc3QgPT09IHRydWUsXG4gICAgICAgIHZlcmJvc2U6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgLy8gUmVhZCBtYW5pZmVzdCBpZiBleGlzdHNcbiAgICAgIGNvbnN0IG1hbmlmZXN0UGF0aCA9IHBhdGguam9pbihwYWNrRGlyLCAnYnI4NjRfcmVhZHknLCAnbWFuaWZlc3QubWQnKTtcbiAgICAgIGxldCBtYW5pZmVzdCA9ICcnO1xuICAgICAgdHJ5IHtcbiAgICAgICAgbWFuaWZlc3QgPSBhd2FpdCBmcy5yZWFkRmlsZShtYW5pZmVzdFBhdGgsICd1dGYtOCcpO1xuICAgICAgfSBjYXRjaCB7fVxuXG4gICAgICBhd2FpdCB1cGRhdGVVcGxvYWRTdGF0dXModXBsb2FkSWQsICdicjg2NC1yZWFkeScpO1xuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBhY3Rpb246ICdwcmVwLWJyODY0JyxcbiAgICAgICAgb3V0cHV0RGlyOiAnYnI4NjRfcmVhZHknLFxuICAgICAgICBtYW5pZmVzdCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnSW52YWxpZCBhY3Rpb24nIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1N0ZW1tYXAgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsicGF0aCIsImZzIiwidjQiLCJ1dWlkdjQiLCJzdGVtbWFwIiwiYXBwbHlTdGVtbWFwIiwicHJlcEJSODY0IiwiZ2V0VXBsb2FkIiwidXBkYXRlVXBsb2FkU3RhdHVzIiwic2F2ZVN0ZW1tYXAiLCJnZXRTdGVtbWFwIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInVwbG9hZElkIiwicXVlcnkiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJ1cGxvYWQiLCJzdGVtbWFwUGF0aCIsImpvaW4iLCJmb2xkZXJfcGF0aCIsInlhbWwiLCJyZWFkRmlsZSIsInN1Y2Nlc3MiLCJhY3Rpb24iLCJzdGVtbWFwRGF0YSIsInBhZFRvTG9uZ2VzdCIsImJvZHkiLCJwYWNrRGlyIiwidGl0bGUiLCJicG1NaW4iLCJicG1NYXgiLCJ2ZXJib3NlIiwiaWQiLCJ1cGxvYWRfaWQiLCJzdGVtbWFwX3lhbWwiLCJwYWNrX3RpdGxlIiwiYnBtIiwia2V5X3NpZ25hdHVyZSIsIndyaXRlRmlsZSIsInBhY2tUaXRsZSIsImtleSIsIm91dHB1dERpciIsIm1hbmlmZXN0UGF0aCIsIm1hbmlmZXN0IiwiY29uc29sZSIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/stemmap.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstemmap&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fstemmap.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();